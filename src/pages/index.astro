---
import Base from "../components/base.astro";
import rasterButton from "../raster-button.png";
---

<Base>
	<main class="h-full w-full bg-[#181818] flex flex-col items-center">
		<h1>Welcome to Helmer</h1>
		<div id="logo">
			<svg
				width="480"
				height="107"
				viewBox="0 0 480 107"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<g style="mix-blend-mode:lighten">
					<circle
						cx="428.5"
						cy="55.5"
						r="51.5"
						fill="url(#paint0_angular_2323_291)"></circle>
					<path
						d="M369.48 3.3279e-06L373.754 40.666L357.315 42.3939C355.584 42.5758 354.828 43.705 354.992 45.2624L360.648 99.08L318.079 103.554L312.604 51.4671C309.749 24.2987 326.91 4.47424 354.079 1.61873L369.48 3.3279e-06Z"
						fill="url(#paint1_radial_2323_291)"></path>
					<path
						d="M306.546 34.9489C302.196 23.6154 294.017 14.1612 283.427 8.22491C272.838 2.28866 260.505 0.244552 248.567 2.44687C236.628 4.64918 225.836 10.9591 218.062 20.283C210.288 29.6069 206.02 41.357 206 53.4969C205.98 65.6368 210.208 77.4012 217.951 86.7511C225.694 96.1009 236.464 102.447 248.395 104.689C260.326 106.932 272.666 104.929 283.275 99.0282C293.884 93.1274 302.095 83.7007 306.483 72.3818L258 53.584L306.546 34.9489Z"
						fill="url(#paint2_angular_2323_291)"></path>
					<path
						d="M160.185 4.2052L201.954 8.5954L191.815 105.064L150.045 100.674L160.185 4.2052Z"
						fill="url(#paint3_linear_2323_291)"></path>
					<path
						d="M133.596 9.11623C109.561 11.2154 87.1876 22.2334 70.8928 39.9952C54.598 57.757 45.5661 80.9717 45.5802 105.056L142 105L133.596 9.11623Z"
						fill="url(#paint4_linear_2323_291)"></path>
					<path
						d="M10.9206 0.399558C37.1355 2.68903 61.5386 14.7043 79.314 34.0743C97.0895 53.4443 106.946 78.7618 106.938 105.031L1.75306 105L10.9206 0.399558Z"
						fill="url(#paint5_linear_2323_291)"></path>
				</g>
				<defs>
					<radialGradient
						id="paint0_angular_2323_291"
						cx="0"
						cy="0"
						r="1"
						gradientUnits="userSpaceOnUse"
						gradientTransform="translate(428.5 55.5) rotate(-175.559) scale(51.6551)"
					>
						<stop stop-color="white"></stop>
						<stop offset="1" stop-color="#999999"></stop>
					</radialGradient>
					<radialGradient
						id="paint1_radial_2323_291"
						cx="0"
						cy="0"
						r="1"
						gradientUnits="userSpaceOnUse"
						gradientTransform="translate(343.779 51.7771) rotate(132.141) scale(77.1723 48.972)"
					>
						<stop stop-color="white"></stop>
						<stop offset="1" stop-color="#999999"></stop>
					</radialGradient>
					<radialGradient
						id="paint2_angular_2323_291"
						cx="0"
						cy="0"
						r="1"
						gradientUnits="userSpaceOnUse"
						gradientTransform="translate(258 53.584) rotate(21.6156) scale(52.7065)"
					>
						<stop stop-color="white"></stop>
						<stop offset="1" stop-color="#999999"></stop>
					</radialGradient>
					<linearGradient
						id="paint3_linear_2323_291"
						x1="162.5"
						y1="4"
						x2="183.5"
						y2="105"
						gradientUnits="userSpaceOnUse"
					>
						<stop stop-color="white"></stop>
						<stop offset="1" stop-color="#999999"></stop>
					</linearGradient>
					<linearGradient
						id="paint4_linear_2323_291"
						x1="45.5802"
						y1="8.74995"
						x2="238.08"
						y2="201.589"
						gradientUnits="userSpaceOnUse"
					>
						<stop offset="0.14455" stop-color="#DAD8D8"></stop>
						<stop offset="0.498308" stop-color="#747373"></stop>
					</linearGradient>
					<linearGradient
						id="paint5_linear_2323_291"
						x1="1.75306"
						y1="6.20294e-06"
						x2="1.75305"
						y2="210"
						gradientUnits="userSpaceOnUse"
					>
						<stop stop-color="white"></stop>
						<stop offset="1" stop-color="#999999"></stop>
					</linearGradient>
				</defs>
			</svg>
		</div>
		<p>
			Record razor-sharp, buttery smooth GIFs up to 20 seconds long, right
			from your menu bar!
		</p>

		<p>
			To record, click the tray icon or press Ctrl/Cmd + Shift + 2 and
			select an area.
		</p>

		<p>
			Share your GIFs online with <a
				href="https://twitter.com/search?lang=en&q=(%23MadeWithMicro)"
				>#MadeWithMicro</a
			>, we'd love to see them. Happy recording!
		</p>

		<button>
			<span> Get Started! </span>
			<img src={rasterButton.src} alt="" />
		</button>
	</main>
</Base>

<script>
	import { invoke } from "@tauri-apps/api/core";
	import { getCurrent } from "@tauri-apps/api/window";
	import keybSound from "../keyb.mp3";

	let audioBuffer: AudioBuffer;
	const audioContext =
		new window.AudioContext() || new window.webkitAudioContext();

	document.addEventListener("DOMContentLoaded", () => {
		// Function to fetch and decode the audio file
		const fetchAudio = async (url: string) => {
			try {
				const response = await fetch(url);
				const arrayBuffer = await response.arrayBuffer();
				audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
			} catch (error) {
				console.error("Error fetching or decoding audio:", error);
			}
		};

		// Preload the audio buffer on first user interaction
		const preloadAudio = async () => {
			await fetchAudio(keybSound);
			document.body.removeEventListener("click", preloadAudio);
		};

		preloadAudio();
	});

	const button = document.querySelector("button") as HTMLButtonElement;

	button.addEventListener("click", async () => {
		if (audioBuffer) {
			const source = audioContext.createBufferSource();
			source.buffer = audioBuffer;
			source.connect(audioContext.destination);
			source.start(1.4);
		}

		invoke("request_recording_permission").then((response) => {
			if (response) {
				// getCurrent().close().then();
			}
		});
	});
</script>

<style>
	h1 {
		color: #fff;
		font-family: "Bricolage Grotesque Variable", sans-serif;
		font-size: 22px;
		font-weight: 600;
		letter-spacing: -0.44px;
		margin-bottom: 16px;
		cursor: default;
	}

	main {
		padding-top: 64px;
	}

	#logo {
		margin-bottom: 42px;
	}

	#logo svg {
		width: 300px;
		height: 100%;
	}

	p {
		color: #afafaf;
		max-width: 400px;
		text-align: center;
		font-family: "Bricolage Grotesque Variable", sans-serif;
		font-size: 18px;
		line-height: 1.4em;
		letter-spacing: -0.18px;
		margin-bottom: 16px;
		cursor: default;
	}

	button {
		position: relative;
		border-radius: 14px;
		overflow: hidden;
		/* padding: 14px 36px; */
		/* background-color: #cd7e6e; */
		/* background-image: ; */
		width: fit-content;
		transition: all 0.2s ease;
		margin-top: 24px;
		line-height: normal;
		box-shadow: #874a4a00 0px 4px 12px;
	}
	button span {
		color: #fff;
		font-family: "Bricolage Grotesque Variable", sans-serif;
		text-transform: uppercase;
		font-size: 18px;
		font-weight: 800;
		letter-spacing: -0.72px;
		z-index: 2;
		position: absolute;
		top: calc(50% - 0.6em);
		left: 0;
		height: 100%;
		width: 100%;
	}

	button img {
		z-index: 1;
		width: 180px;
		height: auto;
	}

	button:hover {
		transform: translateY(-2px);
		box-shadow: #613535aa 0px 4px 12px;
	}

	button:active {
		transform: translateY(2px) scale(0.99);
		box-shadow: #613535aa 0px 4px 12px;
	}
</style>
